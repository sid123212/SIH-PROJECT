<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WanderLust</title>

    <!-- ‚úÖ CSS Libraries -->
     <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  integrity="sha512-+Eyf+javWBRjYr6nMMeU5KjkZVZGiChWVbr7cB7ZwvOQXEKP7zV8YYMmUK1nQ7GcV95AUP3rO9rMyXx0u95M1w=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
/>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" />

    <style>
      body {
        background-color: white;
      }
      #loader {
        transition: opacity 1s ease;
      }
      .fade-out {
        opacity: 0;
        pointer-events: none;
      }
    </style>
  </head>

  <body>
    <!-- üîÑ Loader -->
    <div id="loader" class="d-flex justify-content-center align-items-center bg-white position-fixed top-0 start-0 w-100 h-100" style="z-index: 9999;">
      <div class="spinner-border text-danger" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <% if (success && success.length > 0) { %>
      <div id="flash-message" class="alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 1051;">
        <%= success %>
      </div>
    <% } %>

    <!-- üöÄ Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top shadow-sm">
      <div class="container">
        <a class="navbar-brand" href="/listings">
          <i class="fa-solid fa-compass"></i> WanderLust
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <div class="d-flex w-100 justify-content-between align-items-center">
            <!-- üîó Left Nav -->
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="/listings">Explore</a>
              </li>
              <li class="nav-item">
                <a href="/listings/new" class="nav-link">Add Listing</a>

              </li>
              <% if (currentUser) { %>
  <a href="/user/<%= currentUser.handle %>" class="btn btn-outline-dark">
    My Profile
  </a>
<% } else { %>
  <a href="/listings/login" class="btn btn-outline-dark">Login</a>
<% } %>

            </ul>

            <!-- üë§ Right Nav -->
            <div class="d-flex gap-2 align-items-center">
              <% if (currentUser) { %>
                <span class="text-muted small">Welcome, <%= currentUser.username %></span>
                <a class="nav-link" href="/wishlist" title="Wishlist">
                  <i class="fa-solid fa-heart text-danger"></i>
                </a>
                <li>
  <form action="/logout" method="POST" style="display:inline;">
    <button type="submit" class="btn btn-danger">Logout</button>
  </form>
</li>

              <% } else { %>
                <a class="btn btn-outline-dark btn-sm" href="/listings/register">Sign Up</a>
                <a class="btn btn-dark btn-sm" href="/listings/login">Login</a>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- üìÑ Page Content -->
    <div class="container-fluid px-0 mt-3 mb-5">
      <%- body %>

      <% if (showSpinner) { %>
        <div id="welcomeSpinner" class="position-fixed top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center align-items-center bg-white" style="z-index: 9999;">
          <img src="/images/spin-wheel.gif" alt="Spin the Wheel!" class="img-fluid mb-3" style="max-width: 300px;" />
          <h5 class="text-center">Welcome back, <%= currentUser.username %>! Spin to win travel rewards üéÅ</h5>
          <button onclick="document.getElementById('welcomeSpinner').style.display='none'" class="btn btn-outline-danger mt-4">
            <i class="fa fa-times"></i> Close
          </button>
        </div>
        <script>
          setTimeout(() => {
            document.getElementById("welcomeSpinner").style.display = "none";
          }, 5000);
        </script>
      <% } %>
    </div>

    <!-- üì¶ JS Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- ‚è≥ Loader Fade Script -->
    <script>
      window.addEventListener("load", () => {
        const loader = document.getElementById("loader");
        loader.classList.add("fade-out");
        setTimeout(() => loader.style.display = "none", 500);
      });
    </script>

    <!-- üìÖ Flatpickr Init -->
    <script>
      if (document.getElementById("datePicker")) {
        flatpickr("#datePicker", {
          minDate: "today",
          dateFormat: "Y-m-d",
          defaultDate: new Date()
        });
      }
    </script>
<script>
  function fadeOutWelcomeSpinner() {
    const spinner = document.getElementById("welcomeSpinner");
    spinner.classList.add("fade-out");
    setTimeout(() => spinner.remove(), 500);
  }

  // Auto-close after 5 seconds
  setTimeout(() => {
    if (document.getElementById("welcomeSpinner")) {
      fadeOutWelcomeSpinner();
    }
  }, 5000);
</script>

    <!-- üîî Flash Message Auto-Dismiss -->
    <script>
      setTimeout(() => {
        const flash = document.getElementById('flash-message');
        if (flash) {
          flash.style.transition = "opacity 0.5s ease-out";
          flash.style.opacity = "0";
          setTimeout(() => flash.remove(), 500);
        }
      }, 3000);
    </script>
  </body>
</html>