<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üåç AQI & Traffic Recommendations</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { padding: 20px; }
    .dashboard { display: flex; gap: 20px; }
    #map { height: 600px; flex: 1; border: 1px solid #ccc; }
    .cards-container { flex: 1; max-height: 600px; overflow-y: auto; }
    .pollutant-badge { font-size: 0.85rem; margin-right: 5px; }
  </style>
</head>
<body>
  <h1 class="mb-4"><i class="fas fa-car-side"></i> AQI & Traffic Heatmap</h1>

  <div class="dashboard">
    <!-- Map -->
    <div id="map"></div>

    <!-- Sensor Cards -->
    <div class="cards-container">
      <% sensors.forEach(sensor => { %>
        <div class="card mb-3 shadow-sm">
          <div class="card-body">
            <h5 class="card-title"><i class="fas fa-map-marker-alt text-danger"></i> <%= sensor.name %></h5>

            <p>
              <b>AQI:</b> 
              <span class="<%= sensor.aqi > 150 ? 'text-danger' : sensor.aqi > 100 ? 'text-warning' : 'text-success' %>">
                <%= sensor.aqi %> (<%= sensor.pollutant %>)
              </span>
            </p>

            <p>
              <b>Pollutant Concentration:</b> 
              <% for (let key in sensor.pollutantConcentration) { %>
                <span class="badge bg-secondary pollutant-badge">
                  <i class="fas fa-vial"></i> <%= key %>: <%= sensor.pollutantConcentration[key] %> ¬µg/m¬≥
                </span>
              <% } %>
            </p>

            <% if(sensor.healthRisks && sensor.healthRisks.length > 0) { %>
              <p><b>Potential Health Risks:</b></p>
              <ul>
                <% sensor.healthRisks.forEach(risk => { %>
                  <li><i class="fas fa-heartbeat text-danger"></i> <%= risk %></li>
                <% }) %>
              </ul>
            <% } %>

            <% if(sensor.alert) { %>
              <div class="alert alert-warning mt-2">
                <strong><i class="fas fa-exclamation-triangle"></i> Alert:</strong> <%= sensor.alert %>
              </div>
            <% } %>

            <% if(sensor.trafficRestriction) { %>
              <div class="alert alert-info mt-2">
                <strong><i class="fas fa-car-side"></i> Traffic Restriction:</strong> <%= sensor.trafficRestriction %>
              </div>
            <% } %>
          </div>
        </div>
      <% }) %>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

  <script>

    // Initialize map
    const map = L.map('map').setView([28.6139, 77.2090], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    // Prepare heatmap points: [lat, lon, intensity]
    const heatPoints = sensors
      .filter(sensor => sensor.lat && sensor.lon && sensor.vehicleEmission)
      .map(sensor => [sensor.lat, sensor.lon, Math.min(sensor.vehicleEmission / 150, 1)]); // normalize 0-1

    // Add heatmap layer
    L.heatLayer(heatPoints, { radius: 25, blur: 20, maxZoom: 17, gradient: {0.2:'green', 0.5:'orange', 1:'red'} }).addTo(map);

    // Add individual markers
    sensors.forEach(sensor => {
      if(sensor.lat && sensor.lon){
        const color = sensor.aqi > 150 ? 'red' : sensor.aqi > 100 ? 'orange' : 'green';
        const marker = L.circleMarker([sensor.lat, sensor.lon], {
          radius: 8,
          color: color,
          fillColor: color,
          fillOpacity: 0.6
        }).addTo(map);

        let popupContent = `<b>${sensor.name}</b><br>`;
        popupContent += `AQI: ${sensor.aqi} (${sensor.pollutant})<br>`;
        if(sensor.vehicleEmission) popupContent += `<b><i class="fas fa-car-side"></i> Vehicle Emission:</b> ${sensor.vehicleEmission} ¬µg/m¬≥<br>`;
        if(sensor.healthRisks && sensor.healthRisks.length > 0){
          popupContent += '<b>Health Risks:</b><ul>';
          sensor.healthRisks.forEach(risk => { popupContent += `<li>${risk}</li>`; });
          popupContent += '</ul>';
        }
        marker.bindPopup(popupContent);
      }
    });
  </script>
  <!-- Pollution Sources & Effects - Horizontal Cards -->
   <br><br>
<div class="container-fluid mt-4">
  <div class="row justify-content-center g-3">
    
    <!-- Industries -->
    <div class="col-md-3">
      <div class="card h-100 border-danger shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-danger"><i class="fas fa-industry"></i> Industries</h5>
          <p class="card-text">
            Emit particulate matter (PM2.5/PM10), NOx, SOx, VOCs.<br>
            <b>Health Effects:</b> Respiratory & heart problems, long-term lung damage.
          </p>
        </div>
      </div>
    </div>

    <!-- Vehicles -->
    <div class="col-md-3">
      <div class="card h-100 border-warning shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-warning"><i class="fas fa-car-side"></i> Vehicles</h5>
          <p class="card-text">
            Release CO, NOx, PM2.5, hydrocarbons.<br>
            <b>Health Effects:</b> Asthma, bronchitis, cardiovascular diseases.
          </p>
        </div>
      </div>
    </div>

    <!-- Stubble Burning -->
    <div class="col-md-3">
      <div class="card h-100 border-dark shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-dark"><i class="fas fa-fire"></i> Stubble Burning</h5>
          <p class="card-text">
            Produces smoke rich in PM2.5, CO, NOx.<br>
            <b>Health Effects:</b> Eye irritation, respiratory infections.
          </p>
        </div>
      </div>
    </div>

    <!-- Others -->
    <div class="col-md-3">
      <div class="card h-100 border-secondary shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-secondary"><i class="fas fa-smog"></i> Others</h5>
          <p class="card-text">
            Open waste burning, construction dust, chemicals.<br>
            <b>Health Effects:</b> Chronic respiratory issues, allergies, skin irritation.
          </p>
        </div>
      </div>
    </div>

  </div>
</div>

</body>
</html>
